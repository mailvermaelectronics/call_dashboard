<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Call Dashboard Pro+ v2</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:Inter,sans-serif;background:#f4f4f8;transition:0.3s;}
body.dark{background:#111;color:#fff;}

/* SIDEBAR */
#sidebar{
    width:260px;
    height:100vh;
    background:#fff;
    position:fixed;
    top:0; left:0;
    padding:25px;
    box-shadow:4px 0 20px rgba(0,0,0,0.08);
    overflow:auto;
    transition:0.3s;
    z-index:1000;
}
body.dark #sidebar{background:#1b1b1b;}
#sidebar h2{margin-bottom:25px;font-size:22px;font-weight:700;}
.menu-item{padding:12px;border-radius:10px;margin-bottom:8px;cursor:pointer;display:flex;align-items:center;gap:12px;font-size:15px;}
.menu-item:hover{background:#efefef;}
body.dark .menu-item:hover{background:#222;}
.menu-item.active{background:#2196F3;color:white;}
body.dark .menu-item.active{background:#2196F3;color:white;}

/* MOBILE SIDEBAR */
@media(max-width:768px){
    #sidebar{position:relative;width:100%;height:auto;box-shadow:none;}
    #main{margin-left:0;padding:15px;}
} 
@media(min-width:769px){
    #main{margin-left:280px;padding:20px;}
}

/* TOPBAR */
#topbar{display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;margin-bottom:20px;gap:10px;}
#search{padding:10px 14px;width:250px;border-radius:8px;border:1px solid #ccc;}
#modeBtn,#logoutBtn{padding:10px 16px;border:none;border-radius:8px;cursor:pointer;font-weight:600;}
#modeBtn{background:black;color:white;}
body.dark #modeBtn{background:white;color:black;}
#logoutBtn{background:#e63946;color:white;margin-left:10px;}

/* CARDS */
#cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:15px;margin-bottom:20px;}
.card{background:white;padding:20px;border-radius:16px;box-shadow:0 5px 20px rgba(0,0,0,0.1);}
body.dark .card{background:#1b1b1b;}
.card h3{margin:0;font-size:15px;opacity:0.8;}
.card .value{font-size:28px;font-weight:700;margin-top:8px;text-align:center;}

/* FILTERS */
#filters{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:20px;}
.filterBtn{padding:10px 16px;border-radius:8px;border:1px solid #bbb;cursor:pointer;background:white;}
.filterBtn.active{background:black;color:white;border-color:black;}
body.dark .filterBtn{background:#1f1f1f;color:white;border-color:#444;}

/* TABLE */
table{width:100%;border-collapse:collapse;background:white;border-radius:16px;overflow:hidden;margin-bottom:30px;}
body.dark table{background:#1b1b1b;}
th,td{padding:12px;border-bottom:1px solid #eee;text-align:center;}
body.dark th,body.dark td{border-color:#333;}
th{background:#fafafa;}
body.dark th{background:#222;}
@media(max-width:600px){
    table,thead,tbody,th,td,tr{display:block;}
    th{display:none;}
    td{padding:10px;position:relative;border:none;border-bottom:1px solid #444;}
    td:before{position:absolute;top:10px;left:10px;width:120px;font-weight:600;color:#888;white-space:nowrap;}
    td:nth-of-type(1):before{content:"Number";}
    td:nth-of-type(2):before{content:"Name";}
    td:nth-of-type(3):before{content:"Type";}
    td:nth-of-type(4):before{content:"Duration";}
    td:nth-of-type(5):before{content:"Date";}
}

/* CHARTS */
#chartBox{background:white;border-radius:20px;padding:25px;margin-top:20px;box-shadow:0 5px 25px rgba(0,0,0,0.1);}
body.dark #chartBox{background:#1b1b1b;}
canvas{max-width:100% !important;height:auto !important;}
</style>
</head>
<body>

<!-- SIDEBAR -->
<div id="sidebar">
    <h2>ðŸ“ž Dashboard Pro+</h2>
    <div class="menu-item active" data-section="dashboard"><i class="fa fa-chart-line"></i> Dashboard</div>
    <div class="menu-item" data-section="calls"><i class="fa fa-phone"></i> Call Logs</div>
    <div class="menu-item" data-section="profile"><i class="fa fa-user"></i> Profile</div>
    <div class="menu-item" data-section="settings"><i class="fa fa-gear"></i> Settings</div>
</div>

<!-- MAIN PANEL -->
<div id="main">
    <div id="topbar">
        <input id="search" placeholder="Search number or name...">
        <div>
            <button id="modeBtn">Dark Mode</button>
            <button id="logoutBtn">Logout</button>
        </div>
    </div>

    <div id="cards">
        <div class="card"><h3>Total Calls</h3><div class="value" id="totalCalls">0</div></div>
        <div class="card"><h3>Missed Calls</h3><div class="value" id="missedCalls">0</div></div>
        <div class="card"><h3>Today's Calls</h3><div class="value" id="todayCalls">0</div></div>
    </div>

    <div id="filters">
        <button class="filterBtn active" data-type="all">All</button>
        <button class="filterBtn" data-type="incoming">Incoming</button>
        <button class="filterBtn" data-type="outgoing">Outgoing</button>
        <button class="filterBtn" data-type="missed">Missed</button>
    </div>

    <table>
        <thead>
            <tr>
                <th>Number</th>
                <th>Name</th>
                <th>Type</th>
                <th>Duration</th>
                <th>Date</th>
            </tr>
        </thead>
        <tbody id="tbody"></tbody>
    </table>

    <div id="chartBox">
        <h3>Call Type Distribution</h3>
        <canvas id="chart"></canvas>
    </div>

    <div id="chartBox">
        <h3>Monthly Calls</h3>
        <canvas id="monthChart"></canvas>
    </div>
</div>

<script>
// LOGIN PROTECTION
if(localStorage.getItem("auth")!=="1"){ window.location.href="index.html"; }

// MENU ITEM CLICK
document.querySelectorAll(".menu-item").forEach(item=>{
    item.onclick=()=>{
        document.querySelectorAll(".menu-item").forEach(i=>i.classList.remove("active"));
        item.classList.add("active");
        // Currently we do not hide content, mobile view same as desktop
    };
});

// DARK MODE
document.getElementById("modeBtn").onclick=()=>{
    document.body.classList.toggle("dark");
    document.getElementById("modeBtn").innerText = document.body.classList.contains("dark")?"Light Mode":"Dark Mode";
};

// LOGOUT
document.getElementById("logoutBtn").onclick=()=>{
    localStorage.removeItem("auth");
    window.location.href="index.html";
};

// DATA
let allData=[], chart, monthlyChart;
async function loadData(){
    try{
        let res=await fetch("data.json?cache="+Math.random());
        allData=await res.json();
        updateTable(allData);
        updateStats(allData);
        updateChart(allData);
        updateMonthlyChart(allData);
    }catch(e){ console.error(e); }
}
loadData();
setInterval(loadData,8000);

function updateStats(d){
    document.getElementById("totalCalls").innerText=d.length;
    document.getElementById("missedCalls").innerText=d.filter(x=>x.type==="missed").length;
    let today=new Date().toISOString().slice(0,10);
    document.getElementById("todayCalls").innerText=d.filter(x=>x.date.includes(today)).length;
}

function updateTable(data){
    let tb=document.getElementById("tbody");
    tb.innerHTML="";
    data.slice().reverse().forEach(c=>{
        tb.innerHTML+=`<tr>
            <td>${c.number}</td>
            <td>${c.name}</td>
            <td>${c.type}</td>
            <td>${c.duration}</td>
            <td>${c.date}</td>
        </tr>`;
    });
}

document.getElementById("search").onkeyup=()=>{
    let q=document.getElementById("search").value.toLowerCase();
    let f=allData.filter(x=>x.number.toLowerCase().includes(q)||x.name.toLowerCase().includes(q));
    updateTable(f); updateChart(f); updateMonthlyChart(f);
};

document.querySelectorAll(".filterBtn").forEach(btn=>{
    btn.onclick=()=>{
        document.querySelectorAll(".filterBtn").forEach(b=>b.classList.remove("active"));
        btn.classList.add("active");
        let t=btn.dataset.type;
        let f=t==="all"?allData:allData.filter(x=>x.type===t);
        updateTable(f); updateChart(f); updateMonthlyChart(f);
    };
});

// CHARTS
function updateChart(data){
    let incoming=data.filter(x=>x.type==="incoming").length;
    let outgoing=data.filter(x=>x.type==="outgoing").length;
    let missed=data.filter(x=>x.type==="missed").length;
    if(chart) chart.destroy();
    chart=new Chart(document.getElementById("chart"),{
        type:"doughnut",
        data:{labels:["Incoming","Outgoing","Missed"],datasets:[{data:[incoming,outgoing,missed],backgroundColor:["#4CAF50","#2196F3","#e63946"]}]},
        options:{responsive:true,plugins:{legend:{position:"bottom"}}}
    });
}

function updateMonthlyChart(data){
    let months={};
    data.forEach(x=>{let m=x.date.slice(0,7); months[m]=(months[m]||0)+1;});
    let labels=Object.keys(months).sort();
    let values=labels.map(k=>months[k]);
    if(monthlyChart) monthlyChart.destroy();
    monthlyChart=new Chart(document.getElementById("monthChart"),{
        type:"bar",
        data:{labels,datasets:[{label:"Monthly Calls",data:values,backgroundColor:"#2196F3"}]},
        options:{responsive:true,plugins:{legend:{display:false}}}
    });
}

// LIVE WEBHOOK
async function pushWebhook(data){
    allData.push(data);
    updateTable(allData);
    updateStats(allData);
    updateChart(allData);
    updateMonthlyChart(allData);
}
try{
    const stream=new EventSource("https://your-proxy-endpoint/webhook");
    stream.onmessage=e=>pushWebhook(JSON.parse(e.data));
}catch(err){console.log("Webhook unavailable",err);}
</script>
</body>
</html>
