<!-- FULL PRO+ DASHBOARD CODE READY FOR DEPLOYMENT -->
<!-- Modern UI â€¢ Sidebar â€¢ Animated Charts â€¢ Stats Cards â€¢ Filters â€¢ Dark Mode -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Call Dashboard Pro+ v2</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
<script src="https://cdn.jsdelivr.net/npm/chart.js">// ======== LIVE WEBHOOK SUPPORT ========
// Receive realtime POST updates directly from MacroDroid â†’ GitHub Proxy

async function pushWebhook(data){
    // This function handles live webhook events
    // Append new record instantly
    allData.push(data);
    updateStats(allData);
    updateTable(allData);
    updateChart(allData);
    updateMonthlyChart(allData);
}

// Example: listening via EventSource (Serverâ€‘Sent Events)
try{
    const stream = new EventSource("https://your-proxy-endpoint/webhook");
    stream.onmessage = function(e){
        let payload = JSON.parse(e.data);
        pushWebhook(payload);
    }
}catch(err){ console.log("Webhook stream unavailable", err); }

// ======== MONTHLY BAR CHART ========
let monthlyChart;

function updateMonthlyChart(data){
    let months = {};

    data.forEach(x =>{
        let m = x.date.slice(0,7); // YYYY-MM
        months[m] = (months[m]||0) + 1;
    });

    let labels = Object.keys(months).sort();
    let values = labels.map(k => months[k]);

    if(monthlyChart) monthlyChart.destroy();

    monthlyChart = new Chart(document.getElementById('monthChart'),{
        type:'bar',
        data:{ labels, datasets:[{ label:'Monthly Calls', data:values, backgroundColor:'#2196F3' }] },
        options:{ responsive:true, plugins:{legend:{display:false}} }
    });
}

updateMonthlyChart(allData);

</script>
<style>
    body{
        font-family: Inter, sans-serif;
        margin:0; padding:0;
        background:#f4f4f8;
        transition:0.3s;
        overflow-x:hidden;
    }
    .dark{ background:#111; color:white; }

    /* SIDEBAR */
    #sidebar{
        width:260px;
        height:100vh;
        background:white;
        position:fixed;
        top:0; left:0;
        box-shadow:4px 0 20px rgba(0,0,0,0.08);
        padding:25px;
    }
    .dark #sidebar{ background:#1b1b1b; }

    #sidebar h2{
        margin:0 0 25px;
        font-size:22px;
        font-weight:700;
    }
    .menu-item{
        padding:12px;
        border-radius:10px;
        margin-bottom:8px;
        cursor:pointer;
        display:flex;
        align-items:center;
        gap:12px;
        font-size:15px;
    }
    .menu-item:hover{
        background:#efefef;
    }
    .dark .menu-item:hover{
        background:#222;
    }

    /* MAIN PANEL */
    #main{
        margin-left:300px;
        padding:30px;
    }

    #topbar{
        display:flex;
        justify-content:space-between;
        align-items:center;
        margin-bottom:25px;
    }

    #search{ padding:10px 14px; width:250px; border-radius:8px; border:1px solid #ccc; }

    #modeBtn,#logoutBtn{
        padding:10px 16px;
        border:none;
        border-radius:8px;
        cursor:pointer;
        font-weight:600;
    }
    #modeBtn{ background:black; color:white; }
    .dark #modeBtn{ background:white;color:black; }

    #logoutBtn{ background:#e63946; color:white; margin-left:10px; }

    /* STATS CARDS */
    #cards{
        display:grid;
        grid-template-columns:repeat(3,1fr);
        gap:20px;
        margin-bottom:30px;
    }

    .card{
        background:white;
        padding:20px;
        border-radius:16px;
        box-shadow:0 5px 20px rgba(0,0,0,0.1);
    }
    .dark .card{ background:#1b1b1b; }

    .card h3{ margin:0; font-size:15px; opacity:0.8; }
    .card .value{ font-size:28px; font-weight:700; margin-top:8px; }

    /* FILTERS */
    #filters{ display:flex; gap:10px; margin-bottom:20px; }
    .filterBtn{
        padding:10px 16px;
        border-radius:8px;
        border:1px solid #bbb;
        cursor:pointer;
        background:white;
    }
    .filterBtn.active{ background:black !important; color:white !important; border-color:black; }
    .dark .filterBtn{ background:#1f1f1f; color:white; border-color:#444; }

    /* TABLE */
    table{ width:100%; border-collapse:collapse; background:white; border-radius:16px; overflow:hidden; }
    .dark table{ background:#1b1b1b; }
    th,td{ padding:12px; border-bottom:1px solid #eee; text-align:center; }
    .dark td,.dark th{ border-color:#333; }
    th{ background:#fafafa; }
    .dark th{ background:#222; }

    /* CHART */
    #chartBox{
        background:white;
        border-radius:20px;
        padding:25px;
        margin-top:30px;
        box-shadow:0 5px 25px rgba(0,0,0,0.1);
    }
    .dark #chartBox{ background:#1b1b1b; }
</style>
</head>
<body>

<div id="sidebar">
    <h2>ðŸ“ž Dashboard Pro+</h2>
    <div class="menu-item"><i class="fa fa-chart-line"></i> Dashboard</div>
    <div class="menu-item"><i class="fa fa-phone"></i> Call Logs</div>
    <div class="menu-item"><i class="fa fa-user"></i> Profile</div>
    <div class="menu-item"><i class="fa fa-gear"></i> Settings</div>
</div>

<div id="main">

    <div id="topbar">
        <input id="search" placeholder="Search number or name..." />
        <div>
            <button id="modeBtn">Dark Mode</button>
            <button id="logoutBtn">Logout</button>
        </div>
    </div>

    <div id="cards">
        <div class="card"><h3>Total Calls</h3><div class="value" id="totalCalls">0</div></div>
        <div class="card"><h3>Missed Calls</h3><div class="value" id="missedCalls">0</div></div>
        <div class="card"><h3>Today's Calls</h3><div class="value" id="todayCalls">0</div></div>
    </div>

    <div id="filters">
        <button class="filterBtn active" data-type="all">All</button>
        <button class="filterBtn" data-type="incoming">Incoming</button>
        <button class="filterBtn" data-type="outgoing">Outgoing</button>
        <button class="filterBtn" data-type="missed">Missed</button>
    </div>

    <table>
        <thead>
            <tr>
                <th>Number</th>
                <th>Name</th>
                <th>Type</th>
                <th>Duration</th>
                <th>Date</th>
            </tr>
        </thead>
        <tbody id="tbody"></tbody>
    </table>

    <div id="chartBox">
        <canvas id="chart"></canvas>
    </div>
</div>

<script>
// Login protection
if(localStorage.getItem("auth") !== "1"){
    window.location.href = "index.html";
}

let allData = [];
let chart;

async function loadData(){
    let res = await fetch("data.json?cache=" + Math.random());
    allData = await res.json();
    updateTable(allData);
    updateStats(allData);
    updateChart(allData);
}
loadData();
setInterval(loadData, 8000);

function updateStats(d){
    document.getElementById("totalCalls").innerText = d.length;
    document.getElementById("missedCalls").innerText = d.filter(x => x.type==="missed").length;
    let today = new Date().toISOString().slice(0,10);
    document.getElementById("todayCalls").innerText = d.filter(x => x.date.includes(today)).length;
}

function updateTable(data){
    let tb = document.getElementById("tbody");
    tb.innerHTML = "";
    data.slice().reverse().forEach(c =>{
        tb.innerHTML += `<tr>
            <td>${c.number}</td>
            <td>${c.name}</td>
            <td>${c.type}</td>
            <td>${c.duration}</td>
            <td>${c.date}</td>
        </tr>`;
    });
}

// Search
search.onkeyup = ()=>{
    let q = search.value.toLowerCase();
    let f = allData.filter(x => x.number.toLowerCase().includes(q) || x.name.toLowerCase().includes(q));
    updateTable(f); updateChart(f);
};

// Filters
document.querySelectorAll(".filterBtn").forEach(btn=>{
    btn.onclick = ()=>{
        document.querySelectorAll(".filterBtn").forEach(b=>b.classList.remove("active"));
        btn.classList.add("active");
        let t = btn.dataset.type;
        if(t==="all") return updateTable(allData), updateChart(allData);
        let f = allData.filter(x => x.type===t);
        updateTable(f); updateChart(f);
    };
});

function updateChart(data){
    let incoming = data.filter(x=>x.type==="incoming").length;
    let outgoing = data.filter(x=>x.type==="outgoing").length;
    let missed = data.filter(x=>x.type==="missed").length;

    if(chart) chart.destroy();

    chart = new Chart(chart, {
        type:"doughnut",
        data:{ labels:["Incoming","Outgoing","Missed"], datasets:[{ data:[incoming,outgoing,missed], backgroundColor:["#4CAF50","#
